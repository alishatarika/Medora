<!DOCTYPE html>
<html>
<head>
    <title>Doctor Profile - Medora</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .error-msg {
            color: #ff6b6b;
            font-size: 0.9em;
            margin-top: 4px;
            display: none;
        }
    </style>
</head>
<body class="bg-dark text-white">
<div class="container my-4">
    <h2 class="text-info mb-3">{{ doctor['name'] }}</h2>
    <p>Specialty: {{ doctor['specialty'] }}</p>
    <p>Location: {{ doctor['location'] }}</p>
    <p>Experience: {{ doctor['experience'] }} yrs</p>
    <p>Fee: ₹{{ doctor['fees'] }}</p>
    <h3 class="mt-4">Book Appointment</h3>
    <form method="post" action="{{ url_for('book_appointment', doc_id=doctor['id']) }}" id="appointmentForm">
        <div class="mb-3">
            <label class="form-label">Name:</label>
            <input class="form-control" type="text" name="name" placeholder="Your Name" required>
            <div class="error-msg" id="nameError">⚠️ Please enter your name.</div>
        </div>

        <div class="mb-3">
            <label class="form-label">Email:</label>
            <input class="form-control" type="email" name="email" placeholder="Your Email" required>
            <div class="error-msg" id="emailError">⚠️ Please enter a valid email address.</div>
        </div>

        <div class="mb-3">
            <label class="form-label">Phone:</label>
            <input class="form-control" type="text" name="phone" placeholder="10-digit Phone" required>
            <div class="error-msg" id="phoneError">⚠️ Phone number must be exactly 10 digits.</div>
        </div>

        <div class="mb-3">
            <label class="form-label">Date:</label>
            <input class="form-control" type="date" name="date" min="{{ today }}" required>
            <!-- date validation handled by HTML pattern -->
        </div>

        <div class="mb-3">
            <label class="form-label">Time Slot:</label>
            <select class="form-select" name="time_slot" required>
                {% for slot in time_slots %}
                    <option value="{{ slot }}">{{ slot }}</option>
                {% endfor %}
            </select>
            <div class="error-msg" id="slotError">⚠️ Please select a time slot.</div>
        </div>

        <button type="submit" class="btn btn-success mt-2 w-100">Book Appointment</button>
    </form>

    <a href="{{ url_for('doctors') }}" class="btn btn-secondary mt-3">⬅ Back to Doctors</a>
</div>

<script>
document.getElementById("appointmentForm").addEventListener("submit", function(e) {
    let valid = true;

    const name = this.name.value.trim();
    const email = this.email.value.trim();
    const phone = this.phone.value.trim();
    const slot = this.time_slot.value.trim();

    // Hide all previous errors
    document.querySelectorAll(".error-msg").forEach(el => el.style.display = "none");

    // Name validation
    if (name === "") {
        document.getElementById("nameError").style.display = "block";
        valid = false;
    }

    // Email validation
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
        document.getElementById("emailError").style.display = "block";
        valid = false;
    }

    // Phone validation
    if (!/^\d{10}$/.test(phone)) {
        document.getElementById("phoneError").style.display = "block";
        valid = false;
    }

    // Slot validation
    if (slot === "") {
        document.getElementById("slotError").style.display = "block";
        valid = false;
    }

    if (!valid) e.preventDefault();
});
</script>
</body>
</html>
